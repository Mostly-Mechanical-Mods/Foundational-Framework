gui_diplomacy = { value = diplomacy }
gui_martial = { value = martial }
gui_stewardship = { value = stewardship }
gui_intrigue = { value = intrigue }
gui_learning = { value = learning }
gui_ai_honor = { value = ai_honor }

FF_BMU_claimant_count = {
	every_in_list = {
		variable = BMU_pressed_claim_stakeholders
		limit = { has_variable = claimant }
		add = 1
	}
}

FF_BMU_contender_count = {
	every_in_list = {
		variable = BMU_pressed_claim_stakeholders
		limit = {
			has_variable = status
			var:status = flag:contender
		}
		add = 1
	}
}

FF_BMU_stakeholder_count = {
	every_in_list = {
		variable = BMU_pressed_claim_stakeholders
		limit = {
			has_variable = status
			OR = {
				var:status = flag:stakeholder
				var:status = flag:supporter
			}
		}
		add = 1
	}
}

FF_BMU_contender_mil_strength = {
	if = {
		limit = {
			save_temporary_scope_as = s_contender
			exists = scope:pressed_claim
		}
		scope:pressed_claim = {
			every_in_list = {
				variable = BMU_pressed_claim_stakeholders
				limit = {
					has_variable = status
					OR = {
						var:status = flag:supporter
						var:status = flag:contender
					}
					has_variable = contender
					var:contender.var:stakeholder = scope:s_contender
				}
				add = var:stakeholder.max_military_strength
			}
		}
	}
}

FF_BMU_contender_supporter_count = {
	if = {
		limit = { exists = scope:pressed_claim }
		scope:pressed_claim = {
			every_in_list = {
				variable = BMU_pressed_claim_stakeholders
				limit = {
					has_variable = status
					var:status = flag:supporter
					has_variable = contender
					var:contender.var:stakeholder = root
				}
				add = 1
			}
		}
	}
}

FF_BMU_supporter_diff = {
	if = {
		limit = {
			exists = scope:player_score
			scope:player_score = { save_temporary_scope_as = candidate }
		}
		scope:player_score = { add = BMU_contender_score }
	}
	if = {
		limit = {
			exists = scope:score_to_beat
			scope:score_to_beat = { save_temporary_scope_as = candidate }
		}
		if = {
			limit = { scope:score_to_beat > 0 }
			scope:score_to_beat = { subtract = BMU_contender_score }
		}
	}
	else = {
		scope:pressed_claim.var:claim_target = { subtract = BMU_contender_score }
	}
}

# FF_BMU_supporter_diff = {
# 	if = { limit = { save_temporary_scope_as = PoV }}
# 	scope:player_score = { add = BMU_contender_score }
# 	scope:story = {
# 		ordered_in_list = {
# 			variable = BMU_pressed_claim_stakeholders
# 			limit = {
# 				has_variable = contender
# 				NOT = { var:contender.var:stakeholder = scope:player_score }
# 			}
# 			order_by = {
# 				scope:PoV = { prev.var:stakeholder = { add = BMU_contender_score }}
# 			}
# 			scope:PoV = { prev.var:stakeholder = { subtract = BMU_contender_score }}
# 		}
# 	}
# 	# if = {
# 	# 	limit = {
# 	# 		any_owned_story = {
# 	# 			story_type = BMU_stakeholder_story
# 	# 			var:pressed_claim = scope:story
# 	# 			NOT = { var:status = flag:supporter }
# 	# 		}
# 	# 	}
# 	# }
# }

FF_BMU_supporter_diff_2 = {
	if = { limit = { save_temporary_scope_as = PoV }}
	scope:player_score = { add = BMU_contender_score }
	scope:pressed_claim = {
		ordered_in_list = {
			variable = BMU_pressed_claim_stakeholders
			limit = { NOT = { var:stakeholder = scope:player_score }}
			order_by = { var:stakeholder = { root = { prev = { add = BMU_contender_score }}}}
			var:stakeholder = { root = { prev = { add = BMU_contender_score }}}
		}
	}
}

FF_BMU_supporter_diff_3 = {
	if = {
		limit = {
			scope:player_story = {
				has_variable = status
				OR = {
					var:status = flag:supporter
					var:status = flag:contender
				}
			}
		}
		scope:supporter_story = {
			var:stakeholder = { scope:player_story.var:contender.var:stakeholder = { add = BMU_contender_score }}
			if = {
				limit = {
					has_variable = status var:status = flag:supporter
					NOT = { scope:player_story.var:contender = var:contender }
				}
				var:stakeholder = { scope:supporter_story.var:contender.var:stakeholder = { subtract = BMU_contender_score }}
			}
		}
	}
}


# FF_test = {
# 	add = {
# 		value = 10
# 		desc = test_1
# 		format = "FF_VALUE_FORMAT"
# 	}
# 	add = {
# 		value = scope:test.liege.diplomacy
# 		desc = test_2
# 		format = "FF_VALUE_FORMAT"
# 	}
# }


FF_pressed_claim_story_duration = {
	add = current_date
	subtract = var:start_date
	divide = 270
}

FF_confidence = {
	if = { limit = { save_temporary_scope_as = PoV }}
	add = FF_BMU_contender_mil_strength
	divide = {
		scope:pressed_claim = {
			ordered_in_list = {
				variable = BMU_pressed_claim_stakeholders
				limit = {
					has_variable = status
					var:status = flag:contender
					NOT = { var:stakeholder = scope:PoV }
				}
				order_by = var:stakeholder.FF_BMU_contender_mil_strength
				position = 0
				add = var:stakeholder.FF_BMU_contender_mil_strength
			}
		}
		min = 1
	}
}

FF_confidence_mod = {
	add = {
		value = {
			if = {
				limit = {
					save_temporary_scope_as = supporter_story
					trigger_if = {
						limit = { NOT = { exists = scope:pressed_claim }}
						var:pressed_claim_story = { save_temporary_scope_as = pressed_claim }
					}
				}
			}
			scope:player_contender.var:stakeholder = { add = FF_BMU_contender_mil_strength }
			var:stakeholder = { add = max_military_strength }
			divide = {
				scope:pressed_claim = {
					ordered_in_list = {
						variable = BMU_pressed_claim_stakeholders
						limit = {
							has_variable = status
							var:status = flag:contender
							NOT = { var:stakeholder = scope:player_contender.var:stakeholder }
						}
						order_by = {
							var:stakeholder = { add = FF_BMU_contender_mil_strength }
							if = {
								limit = {
									is_target_in_variable_list = {
										name = supporters
										target = scope:supporter_story
									}
								}
								scope:supporter_story.var:stakeholder = { subtract = max_military_strength }
							}
						}
						position = 0
						var:stakeholder = { add = FF_BMU_contender_mil_strength }
						if = {
							limit = {
								is_target_in_variable_list = {
									name = supporters
									target = scope:supporter_story
								}
							}
							scope:supporter_story.var:stakeholder = { subtract = max_military_strength }
						}
					}
				}
				min = 1
			}
			scope:player_contender.var:stakeholder = {
				subtract = {
					add = FF_confidence
					# multiply = 100
				}
			}
			multiply = 100
			max = 100
		}
		desc = "BMU_supporter_bargaining_power"
	}
}

FF_bargain_acceptance = {
	# if = {
	# 	limit = {
	# 		scope:contender.var:stakeholder = { save_temporary_scope_as = candidate }
	# 		scope:contender.var:pressed_claim_story = { save_temporary_scope_as = story }
	# 	}
	# }
	# add = {
	# 	value = { scope:contender.var:stakeholder = { add = BMU_contender_score }}
	# 	desc = "FF_bargain_supports_you"
	# 	format = "FF_VALUE_FORMAT"
	# }
	# if = {
	# 	limit = {
	# 		scope:bargain.var:stakeholder_story = { has_variable = contender }
	# 		scope:bargain.var:stakeholder_story.var:contender.var:stakeholder = { save_temporary_scope_as = candidate }
	# 	}
	# 	add = {
	# 		value = { scope:bargain.var:stakeholder_story.var:contender.var:stakeholder = { subtract = BMU_contender_score }}
	# 		desc = "FF_bargain_supports_another"
	# 		format = "FF_VALUE_FORMAT"
	# 	}
	# }
	if = {
		limit = {
			scope:contender.var:stakeholder = { save_temporary_scope_as = candidate }
			trigger_if = {
				limit = { NOT = { exists = scope:pressed_claim }}
				scope:contender.var:pressed_claim_story = { save_temporary_scope_as = pressed_claim }
			}
		}
		if = {
			limit = {
				scope:bargain.var:stakeholder_story = { has_variable = contender }
				scope:bargain.var:stakeholder_story.var:contender.var:stakeholder = {
					save_temporary_scope_as = candidate
					BMU_contender_score > 0
				}
			}
			add = {
				value = {
					scope:contender.var:stakeholder = { add = BMU_contender_score }
					scope:bargain.var:stakeholder_story.var:contender.var:stakeholder = { subtract = BMU_contender_score }
				}
				desc = "FF_bargain_supports_another"
				format = "FF_VALUE_FORMAT"
			}
		}
		else = {
			add = {
				value = { scope:contender.var:stakeholder = { add = BMU_contender_score }}
				desc = "FF_bargain_supports_you"
				format = "FF_VALUE_FORMAT"
			}
		}
	}
	
	add = {
		value = {
			scope:contender.var:stakeholder = { add = FF_BMU_contender_mil_strength }
			add = max_military_strength
			divide = {
				scope:bargain.var:stakeholder_story.var:pressed_claim_story = {
					ordered_in_list = {
						variable = BMU_pressed_claim_stakeholders
						limit = {
							has_variable = status
							var:status = flag:contender
							NOT = { var:stakeholder = scope:contender.var:stakeholder }
						}
						order_by = {
							var:stakeholder = { add = FF_BMU_contender_mil_strength }
							if = {
								limit = {
									is_target_in_variable_list = {
										name = supporters
										target = scope:bargain.var:stakeholder_story
									}
								}
								scope:bargain.var:stakeholder_story.var:stakeholder = { subtract = max_military_strength }
							}
						}
						position = 0
						var:stakeholder = { add = FF_BMU_contender_mil_strength }
						if = {
							limit = {
								is_target_in_variable_list = {
									name = supporters
									target = scope:bargain.var:stakeholder_story
								}
							}
							scope:bargain.var:stakeholder_story.var:stakeholder = { subtract = max_military_strength }
						}
					}
				}
				min = 1
			}
			scope:contender.var:stakeholder = {
				subtract = {
					add = FF_confidence
					# multiply = 100
				}
			}
			multiply = -100
			min = -100
		}
		desc = "FF_military_leverage"
		format = "FF_VALUE_FORMAT"
	}
	add = {
		value = scope:bargain.var:ambition_score
		desc = "FF_bargain_value"
		format = "FF_VALUE_FORMAT"
	}
}

FF_bargain_for_acceptance = {
	if = {
		limit = {
			NOT = { exists = scope:pressed_claim }
			scope:contender.var:pressed_claim_story = { save_temporary_scope_as = pressed_claim }
		}
	}
	add = {
		value = {
			scope:contender.var:stakeholder = { add = FF_BMU_contender_mil_strength }
			add = scope:supporter.var:stakeholder.max_military_strength
			divide = {
				scope:bargain.var:stakeholder_story.var:pressed_claim_story = {
					ordered_in_list = {
						variable = BMU_pressed_claim_stakeholders
						limit = {
							has_variable = status
							var:status = flag:contender
							NOT = { var:stakeholder = scope:contender.var:stakeholder }
						}
						order_by = {
							var:stakeholder = { add = FF_BMU_contender_mil_strength }
							if = {
								limit = {
									is_target_in_variable_list = {
										name = supporters
										target = scope:bargain.var:stakeholder_story
									}
								}
								scope:bargain.var:stakeholder_story.var:stakeholder = { subtract = max_military_strength }
							}
						}
						position = 0
						var:stakeholder = { add = FF_BMU_contender_mil_strength }
						if = {
							limit = {
								is_target_in_variable_list = {
									name = supporters
									target = scope:bargain.var:stakeholder_story
								}
							}
							scope:bargain.var:stakeholder_story.var:stakeholder = { subtract = max_military_strength }
						}
					}
				}
				min = 1
			}
			max = 1.2
			scope:contender.var:stakeholder = {
				subtract = {
					add = FF_confidence
					max = 1.2
					# multiply = 100
				}
			}
			multiply = 100
			max = 100
		}
		desc = "FF_military_leverage"
		format = "FF_VALUE_FORMAT"
	}
	# divide = {
	# 	value = {
	# 		add = scope:contender.var:stakeholder.FF_confidence
	# 		min = 0
	# 	}
	# 	desc = "FF_confidence"
	# 	# format = "FF_VALUE_FORMAT"
	# }
	add = FF_ambition_cost
	# add = {
	# 	value = scope:contender.var:stakeholder.FF_confidence
	# 	desc = "FF_confidence"
	# 	# format = "FF_VALUE_FORMAT"
	# }
}